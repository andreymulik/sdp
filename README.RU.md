# Simple Data Processing

Это библиотека простых обобщённых операций над данными. `sdp` вдохновлена
`array`, `vector`, `bytestring`, отчасти `containers` и `repa`. `sdp`
ориентирована на эффективность и открытость.

## tl;dr

`sdp` призвана объединить основные библиотеки `Haskell Platform` и их
функционал для более комфортной работы и повышения читаемости кода.

Помимо базовых классов и алгоритмов, `sdp` реализует простейшие структуры
данных (массивы и развёрнутые списки) для замены устаревшей библиотеки `array`.

## Мотивация

Назначение `sdp` - предоставлять наиболее комфортный интерфейс для работы с
различными структурами данных в одном пространстве имён без квалифицированных
импортов, сохраняя при этом достаточно высокое качество кода и скорость работы.

## Функционал

`sdp` предоставляет базовые структуры и операции над ними.

### Структуры

В основе всех предопределённых структур лежат псевдо-примитивные типы `SArray#`,
`SBytes#`, `STArray#`, `STBytes#`, `IOArray#`, `IOBytes#`, надёжно
инкапсулирующие настоящие примитивы.

Для определения более сложных структур используются **шаблоны**:
* `AnyBorder` добавляет явные границы произвольного типа.
* `AnyChunks` определяет развёрнутый список с элементами-структурами.

На основе псевдо-примитивов и шаблонов определены:
* неизменяемые массивы `Array` и `Bytes`
* изменяемые массивы `STArray` и `STBytes`, `IOArray` и `IOBytes`
* неизменяемые развёрнутые списки `Unlist` и `Ublist`
* изменяемые развёрнутые списки `STUnlist` и `STUblist`, `IOUnlist` и `IOUblist`
* неизменяемые развёрнутые списки с явными границами: `Unrolled` и `ByteList`
* изменяемые развёрнутые списки с явными границами: `STUnrolled` и `STByteList`,
`IOUnrolled` и `IOByteList`

### Классы

`sdp` предоставляет большой выбор функций для конвертации, мощную абстракцию
данных для написания обобщённых алгоритмов, реализует наиболее востребованные
операции, включая выборку, разбиение и сортировку. С `sdp` списочные функции
не перекрывают свои аналоги для других структур.

`Nullable` - сервисный класс структур с пустыми значениями.

`Bordered` - класс структур с конечным числом элементов и границами.

`Estimate` - сервисный класс для эффективной оценки длины структуры. Позволяет
выражать такие условия как "в структуре более 5 элементов", "в структуре ровно
10 элементов" или "структура 1 короче структуры 2" и вычислять их за конечное
время (в последнем примере хотя бы одна из структур должна быть конечной). Имеет
смысл использовать `Estimate` в случаях, когда вычисление длины структуры
сложнее O(1) и требуется лишь приблизительная оценка.

`Unboxed` - сервисный класс, упрощающий взаимодействие с данными, хранимыми в
`ByteArray#` и `MutableArray#`. Позволяет легко добавлять поддержку новых
типов в основанные на `SBytes#` (`STBytes#`, `IOBytes#`) контейнеры.

`Shape` - сервисный класс операций с размерностями и преобразований
конечномерных индексов.

`Index` - сервисный класс, обобщающий операции перечисления и принадлежности
промежутку. Является улучшенной версией `Ix`.

`Linear` - класс линейных структур, обобщающий стандартные списочные функции.

`Split` - класс разделяемых структур, расширяющий `Linear`.

`Indexed` - класс индексируемых структур, обобщающий операции чтения и
модификации неизменяемых структур.

`Shaped` - класс операций над структурами, обобщёнными по типу индекса.
Позволяет безопасно менять тип и промежуток индексов, быстро извлекать
подпоследовательности.

`Map` - класс операций над словарями.

`Set` - класс операций над множествами.

`Zip` - класс, обобщающий поэлементное объединение структур.

`Scan` - класс свёрток с промежуточными значениями.

`Sort` - класс сортировки неизменяемых структур.

`BorderedM`, `LinearM`, `SplitM`, `IndexedM`, `SortM` - классы операций над
изменяемыми контейнерами.

## Версии

`sdp` соответствует [Haskell PVP](https://pvp.haskell.org). Для упрощения
поиска производных компонентов и согласования их версий я предлагаю такие
правила:
* `МАЖОРНАЯ` версия должна соответствовать наименьшей `МАЖОРНОЙ` версии `sdp`, с
которой она совместима.
* Расширения `sdp` должны называться `sdp-%имярасширения%`, например `sdp-io`
или `sdp-quickcheck`.
* Обёртки `sdp` должны называться `sdp4%имябиблиотеки%`, например `sdp4text`.
* Некоторые обёртки могут называться `sdp2%имябиблиотеки%`, например,
`sdp2binary` (сериализация структур `sdp` при помощи `binary`).

## Отличия от других похожих проектов

* **Внутренняя непротиворечивость.** Я был бы искренне рад, если бы все
библиотеки были последовательными и непротиворечивыми. Текущая `sdp-0.2` стала
в этом отношении гораздо лучше ранних своих версий.
* **Не очередная rebase.** `sdp` работает **вместе** с `base`, обобщает и
расширяет её возможности.
* **Максимальная функциональность при минимальном размере**. По размеру `sdp`
сопоставима с `containers`, причём она требует только 3 простых зависимости
(включая `base`). `sdp` и её зависимости не требуют `array`,
`containers` или `vector`, поэтому библиотека полностью от них независима.
* **Хорошая расширяемость.** Поскольку `sdp` основана на классах типов, в неё
можно легко добавлять новые функции без обновления производных компонентов. Для
совместимости с `sdp` достаточно реализовать несколько открытых и
универсальных интерфейсов.
* **Ориентация на другие библиотеки.** Несмотря на то, что `sdp` создавалась в
качестве замены `array`, её основной задачей было устранение конфликтов имён с
другими библиотеками и, отчасти, между ними. Библиотека скрывает большую часть
квалифицированных импортов благодаря обобщению стандартных функций, а её обёртки
и расширения `sdp` заметно улучшают читаемость кода. Например, вы можете
работать с текстовыми и бинарными потоками (`Text` и `ByteString`) в одном
модуле без лишних квалификаторов.

* **Не очередная ((re)re)base.** `sdp` не заменяет `base`, а обобщает и
расширяет её.
* **Максимальная функциональность при минимальном размере.** `sdp` зависит всего
от трёх пакетов requires (вместе с `base`) и сопоставим по размеру с другими
базовыми пакетами:

| пакет      | версия   | компилятор | .so  | строки | код  |
|------------|----------|------------|------|--------|------|
| sdp        | 0.2      | ghc-8.4.4  | 5.5M | 10.5k  | 5.7k |
| vector     | 0.12.1.2 | ghc-8.10.2 | 4.3M | 16k    | 6.9k |
| containers | 0.6.2.1  | ghc-8.10.2 | 3.5M | 24k    | 6.5k |

* **Расширяемость.** `sdp` это хорошо расширяемая библиотека, которая позволяет
легко интегрировать новые компоненты, упрощает межбиблиотечное взаимодействие.
Функционал самой `sdp` также легко может быть расширен благодаря той гибкости,
которую обеспечивают классы типов.
* **Ориентация на другие библиотеки.** Изначально `sdp` создавался как замена
`array`. Сейчас её основная задача - избавиться от конфликтов имён с другими
библиотеками и между ними. Библиотека обобщает стандартные функции, скрывая
квалифицированные импорты. Обёртки `sdp` также улучшают читаемость кода.
Например, вы можете работать с текстовыми и бинарными потоками (`ByteString` и
`Text`) в одном пространстве имён без лишних квалификаторов.
* **Современный дизайн.** `sdp` это то, как выглядел бы `array`, если бы его
начали писать сейчас. `sdp` неплохо балансирует между открытостью, надёжностью и
производительностью. `sdp` не накладывает существенных ограничений на реализации
и не перебарщивает со сложностью определений, пытаясь быть одновременно понятной
и универсальной библиотекой. При этом `sdp` старается идти в ногу со временем,
обеспечивая поддержку многих нестандартных фич языка, если это уместно.

## Использование категории SDP

Категория `SDP` предназначена для классов и структур, имена которых уже заняты в
категории `Data`. Вы не должны использовать `SDP` вместо `System`, `Control`,
`Foreign` и т.п.

## Содействие

Информация о процессе подачи запросов (pull request) находится в
[CONTRIBUTING.md](https://github.com/andreymulik/sdp/blob/master/CONTRIBUTING.md).

## Лицензия

`sdp` - бесплатное и свободное ПО, вы можете распространять её и/или улучшать по
условиям BSD3. `sdp` распространяется в надежде на практическую полезность, но
без гарантий товарной пригодности или пригодности для конкретных целей, см. файл
`LICENSE`.

